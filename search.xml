<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>Ambari 2.6.x 本地仓库搭建和离线安装</title>
      <link href="/2018/04/01/blog-02/"/>
      <url>/2018/04/01/blog-02/</url>
      <content type="html"><![CDATA[<h1 id="Ambari-2-6-x-本地仓库搭建和离线安装"><a href="#Ambari-2-6-x-本地仓库搭建和离线安装" class="headerlink" title="Ambari 2.6.x 本地仓库搭建和离线安装"></a>Ambari 2.6.x 本地仓库搭建和离线安装</h1><p>ambari若从公网安装，速度缓慢而且成功几率为0（就我而言（捂脸））。所以最好的方式是创建离线仓库，加快安装速度，提高成功几率。本文以Ubuntu 16为列进行离线环境搭建。当然其它系统也ok，你可从<a href="https://docs.hortonworks.com/HDPDocuments/Ambari-2.6.1.5/bk_ambari-installation/content/ch_obtaining-public-repos.html" target="_blank" rel="noopener">公共仓库</a>选择兼容自己系统的包文件进行下载。</p><h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h2><p>你的集群中的所有主机都可通过ssh免密访问集群中的所有节点（包括自身）。若该步未完成，请参考<a href="https://www.jianshu.com/p/6048f305a920" target="_blank" rel="noopener">https://www.jianshu.com/p/6048f305a920</a>中的<strong>准备</strong>一节。</p><h2 id="创建本地仓库"><a href="#创建本地仓库" class="headerlink" title="创建本地仓库"></a>创建本地仓库</h2><ul><li>安装<code>nginx</code>服务器</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nginx</span><br></pre></td></tr></table></figure><ul><li>创建目录作为仓库根目录</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /var/www/ambari</span><br><span class="line">mkdir /var/www/ambari/HDP-UTILS</span><br><span class="line"><span class="built_in">cd</span> /var/www/ambari</span><br></pre></td></tr></table></figure><ul><li>从<a href="https://docs.hortonworks.com/HDPDocuments/Ambari-2.6.1.5/bk_ambari-installation/content/ambari_repositories.html" target="_blank" rel="noopener">ambari仓库</a>和<a href="https://docs.hortonworks.com/HDPDocuments/Ambari-2.6.1.5/bk_ambari-installation/content/hdp_26_repositories.html" target="_blank" rel="noopener">HDP仓库</a>下载符合你的操作系统的ambari和HDP安装程序，这里下载的是Ubuntu 16的安装包</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget http://public-repo-1.hortonworks.com/ambari/ubuntu16/2.x/updates/2.6.1.5/ambari-2.6.1.5-ubuntu16.tar.gz</span><br><span class="line">wget http://public-repo-1.hortonworks.com/HDP/ubuntu14/2.x/updates/2.6.4.0/HDP-2.6.4.0-ubuntu14-deb.tar.gz</span><br><span class="line">wget http://public-repo-1.hortonworks.com/HDP-UTILS-1.1.0.22/repos/ubuntu14/HDP-UTILS-1.1.0.22-ubuntu14.tar.gz</span><br><span class="line">wget http://public-repo-1.hortonworks.com/HDP-GPL/ubuntu14/2.x/updates/2.6.4.0/HDP-GPL-2.6.4.0-ubuntu14-deb.tar.gz</span><br></pre></td></tr></table></figure><p>解压上面下载的文件到指定目录</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf ambari-2.6.1.5-ubuntu16.tar.gz</span><br><span class="line">tar -zxvf HDP-GPL-2.6.4.0-ubuntu14-deb.tar.gz</span><br><span class="line">tar -zxvf HDP-2.6.4.0-ubuntu14-deb.tar.gz</span><br><span class="line">tar -zxvf HDP-UTILS-1.1.0.22-ubuntu14.tar.gz -C HDP-UTILS</span><br></pre></td></tr></table></figure><p>可以看到当前目录(<code>/var/www/ambari</code>)下有如下文件夹：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ambari HDP-GPL HDP HDP-UTILS</span><br></pre></td></tr></table></figure><ul><li>创建nginx配置文件<code>ambari</code></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/nginx/sites-available</span><br><span class="line">vi ambari</span><br></pre></td></tr></table></figure><p>ambari 文件内容如下：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">server_name</span> &lt;host-ip&gt;; <span class="comment"># &lt;host-ip&gt;为服务器地址</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">root</span> /var/www/ambari;</span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span><span class="regexp"> ^~</span> / &#123;</span><br><span class="line"><span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">autoindex_exact_size</span> <span class="literal">off</span>;</span><br><span class="line"><span class="attribute">autoindex_localtime</span> <span class="literal">on</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ /\.ht</span> &#123;</span><br><span class="line"><span class="attribute">deny</span> all;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重启nginx服务器</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ../sites-enabled</span><br><span class="line">ln -s ../sites-available/ambari ambari</span><br><span class="line">service nginx restart</span><br></pre></td></tr></table></figure><ul><li>指定仓库地址</li></ul><p>进入到<code>/etc/apt/sources.list.d</code>文件夹下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/apt/sources.list.d</span><br></pre></td></tr></table></figure><p>创建以下文件，<strong>记得把<code>&lt;host-name&gt;</code>替换为当前机器的ip</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;  cat ambari.list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 因ambari每个大版本后都有小版本号，因此请自行检查路径是否正确</span></span><br><span class="line">deb http://&lt;host-name&gt;/ambari/ubuntu16/2.6.1.5/ Ambari main</span><br><span class="line"></span><br><span class="line">&gt;  cat ambari-hdp.list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 因ambari每个大版本后都有小版本号，因此请自行检查路径是否正确</span></span><br><span class="line">deb http://&lt;host-name&gt;/HDP/ubuntu16/2.6.4.0-91/ HDP main</span><br><span class="line">deb http://&lt;host-name&gt;/HDP-GPL/ubuntu16/2.6.4.0-91/ HDP-GPL main</span><br><span class="line">deb http:/&lt;host-name&gt;/HDP-UTILS/repos/ubuntu16/ HDP-UTILS main</span><br></pre></td></tr></table></figure><p>将这两个文件拷贝到集群的所有机器上，现在本地仓库已经安装完成。</p><h2 id="安装ambari-server"><a href="#安装ambari-server" class="headerlink" title="安装ambari-server"></a>安装ambari-server</h2><p>执行完以上过程后，现在你可在集群中任何一台机器上安装ambari-server。安装教程请参考<a href="https://docs.hortonworks.com/HDPDocuments/Ambari-2.6.1.5/bk_ambari-installation/content/install-ambari-server-ubuntu16.html" target="_blank" rel="noopener">官方安装教程</a>。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ambari-server</span><br></pre></td></tr></table></figure><p>按照安装流程，当出现选择仓库源的界面时，选择使用本地源。</p><p><img src="pictures/choose_repositories_Amb_261.png" alt="选择HDP版本"></p><p>针对HDP, HDP-GPL, HDP-UTILS，它们的地址像这样填写，<strong>具体的主机ip和版本号依你的配置和下载的HDP版本而定，因此请检查你自己的链接是否可用</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://node2.hdp/HDP/ubuntu16/2.6.4.0-91/</span><br><span class="line">http://node2.hdp/HDP-GPL/ubuntu16/2.6.4.0-91/</span><br><span class="line">http://node2.hdp/HDP-UTILS-1.1.0.22/repos/ubuntu16/</span><br></pre></td></tr></table></figure><p>创建和使用本地仓库的过程已完成，接下来可继续按照官方教程进行安装。</p>]]></content>
      
      
        <tags>
            
            <tag> Ubuntu </tag>
            
            <tag> Ambari </tag>
            
            <tag> 离线安装 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Ubuntu16.0.4 手动安装 CDH 5.14.0 （二）cloudera manager安装</title>
      <link href="/2017/09/07/blog-01/"/>
      <url>/2017/09/07/blog-01/</url>
      <content type="html"><![CDATA[<h1 id="Ubuntu16-0-4-手动安装-CDH-5-14-0-（二）cloudera-manager安装"><a href="#Ubuntu16-0-4-手动安装-CDH-5-14-0-（二）cloudera-manager安装" class="headerlink" title="Ubuntu16.0.4 手动安装 CDH 5.14.0 （二）cloudera manager安装"></a>Ubuntu16.0.4 手动安装 CDH 5.14.0 （二）cloudera manager安装</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>当前所使用的系统为Ubuntu 16.0.4，发行版本为 xenial</p><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><h3 id="下载部署相关软件"><a href="#下载部署相关软件" class="headerlink" title="下载部署相关软件"></a>下载部署相关软件</h3><ul><li><p>Step 1：下载以下软件</p><ul><li><a href="http://archive.cloudera.com/cm5/cm/5/" target="_blank" rel="noopener">Cloudera Manager安装包</a>，这里使用5.14.0版本。<ul><li>cloudera-manager-xenial-cm5.14.0_amd64.tar.gz</li></ul></li><li><p><a href="http://archive.cloudera.com/cdh5/parcels/latest/" target="_blank" rel="noopener">CDH离线资源包</a>(parcel用安装包)，只下载以下文件即可：</p><ul><li>CDH-5.14.0-1.cdh5.14.0.p0.24-xenial.parcel</li><li>CDH-5.14.0-1.cdh5.14.0.p0.24-xenial.parcel.sha1</li><li>manifest.json</li></ul></li><li><p><a href="http://central.maven.org/maven2/mysql/mysql-connector-java/5.1.45/mysql-connector-java-5.1.45.jar" target="_blank" rel="noopener">mysql jdbc连接库</a></p></li></ul></li><li><p>Step2: 部署软件</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/cloudera-manager</span><br><span class="line">tar -xzvf cloudera-manager-xenial-cm5.14.0_amd64.tar.gz -C /opt/cloudera-manager</span><br><span class="line">mkdir -p /opt/cloudera/parcel-repo</span><br><span class="line">mv CDH-5.14.0-1.cdh5.14.0.p0.24-xenial.parcel.sha1 CDH-5.14.0-1.cdh5.14.0.p0.24-xenial.parcel.sha</span><br><span class="line">cp CDH-5.14.0-1.cdh5.14.0.p0.24-xenial.parcel CDH-5.14.0-1.cdh5.14.0.p0.24-xenial.parcel.sha manifest.json /opt/cloudera/parcel-repo</span><br></pre></td></tr></table></figure><p>最终的目录结构如下所示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/opt</span><br><span class="line">  |-/cloudera</span><br><span class="line">  |  |-/parcels</span><br><span class="line">  |  |-/parcel-repo</span><br><span class="line">  |  |  |-CDH-5.14.0-1.cdh5.14.0.p0.24-xenial.parcel</span><br><span class="line">  |  |  |-CDH-5.14.0-1.cdh5.14.0.p0.24-xenial.parcel.sha</span><br><span class="line">  |  |  |-manifest.json</span><br><span class="line">  |-/cloudera-manager</span><br><span class="line">  |  |-/cm5.14.0</span><br></pre></td></tr></table></figure><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="添加cloudera仓库"><a href="#添加cloudera仓库" class="headerlink" title="添加cloudera仓库"></a>添加cloudera仓库</h3><ul><li>Step 1</li></ul><p>从 <a href="https://www.cloudera.com/documentation/enterprise/latest/topics/cm_vd.html" target="_blank" rel="noopener">Cloudera Manager Version and Download Information </a><br>找到适合当前操作系统版本的cloudera包文件(这里是<br><code>https://archive.cloudera.com/cm5/ubuntu/xenial/amd64/cm/cloudera.list</code>)，<br>将文件中的内容复制到<code>/etc/apt/sources.list.d/cloudera-manager.list</code><br>没有则新建。</p><ul><li>Step 2：安装仓库密钥（可选）</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://archive.cloudera.com/cdh5/ubuntu/xenial/amd64/cdh/archive.key -O archive.key</span><br><span class="line">sudo apt-key add archive.key</span><br><span class="line">apt-get update</span><br></pre></td></tr></table></figure><h3 id="cloudera-manager-安装和配置"><a href="#cloudera-manager-安装和配置" class="headerlink" title="cloudera manager 安装和配置"></a>cloudera manager 安装和配置</h3><ul><li>Step 1：安装cloudera server和cloudera agent</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install cloudera-manager-daemons cloudera-manager-server</span><br><span class="line">sudo apt-get install cloudera-manager-agent</span><br></pre></td></tr></table></figure><ul><li>Step2：配置cloudera agent</li></ul><p>修改<code>/etc/cloudera-scm-agent/config.ini</code>文件的以下选项：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server_host=master</span><br><span class="line">server_port=7182 #若改端口被占用，改为其它端口</span><br></pre></td></tr></table></figure><ul><li>Step3：添加mysql连接库</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp mysql-connector-java-5.1.45.jar /usr/share/cmf/lib</span><br></pre></td></tr></table></figure><ul><li>Step4：更改文件所有者</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown cloudera-scm:cloudera-scm /opt/cloudera/parcels</span><br><span class="line">chown -R cloudera-scm:cloudera-scm /opt/cloudera/parcel-repo</span><br></pre></td></tr></table></figure><h3 id="cloudera-manager数据库账户设置"><a href="#cloudera-manager数据库账户设置" class="headerlink" title="cloudera manager数据库账户设置"></a>cloudera manager数据库账户设置</h3><p>此处假设我们的cloudera manager所使用的数据库为scm,用户名为scm，密码为scm。</p><ul><li>step 1：进入mysql命令界面</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure><ul><li>step 2：使能远程连接到scm账户</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> all <span class="keyword">on</span> *.* <span class="keyword">to</span> <span class="string">'scm'</span>@<span class="string">'%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'scm'</span> <span class="keyword">with</span> <span class="keyword">grant</span> <span class="keyword">option</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure><ul><li>step 3</li></ul><p>若之前已尝试过安装，会有遗留的文件，删除：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -f /etc/cloudera-scm-server/db.*</span><br></pre></td></tr></table></figure><p>使用以下命令创建和配置数据库及数据库用户</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/cmf/schema/scm_prepare_database.sh mysql -hmaster -uroot -proot --scm-host master scm scm scm</span><br></pre></td></tr></table></figure><p><strong>说明</strong>：该脚本用来创建和配置CMS需要的数据库。各参数是指：</p><ul><li><p>mysql：数据库用的是mysql，如果安装过程中用的oracle，那么该参数就应该改为oracle。</p></li><li><p>-uroot：root身份运行mysql。-proot：mysql的root密码是root。</p></li><li><p>–scm-host localhost ：CMS的主机，一般是和mysql安装的主机是在同一个主机上。</p></li><li><p>最后三个参数是：数据库名，数据库用户名，数据库密码。</p></li></ul><p><strong>注意</strong>：如果创建失败，根据报错日志，可能需删去数据库与用户，进行排错。相关命令如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> <span class="keyword">concat</span>(<span class="string">'User:'''</span>,<span class="keyword">user</span>,<span class="string">'''@'''</span>,host,<span class="string">''';'</span>)<span class="keyword">as</span> <span class="keyword">query</span> <span class="keyword">from</span> mysql.user; //查看用户</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> scmdbn; //删除数据库</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">User</span> <span class="string">'scmdbu'</span>@<span class="string">'master'</span>; //删除用户</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> CDH </tag>
            
            <tag> cloudera manager </tag>
            
            <tag> Ubuntu </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
